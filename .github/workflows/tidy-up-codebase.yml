name: Weekly CN Task

on:
  schedule:
    # Runs at 8/9:30 AM PST (16:30 UTC) every Monday so PR shows up at beginning of week
    - cron: "30 16 * * 1"
  workflow_dispatch: # Allows manual triggering

jobs:
  run-cn-task:
    runs-on: ubuntu-latest

    steps:
      - name: Call agents endpoint
        run: |
          response=$(curl -f -X POST https://api.continue.dev/agents \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.CONTINUE_API_KEY }}" \
            -d '{
              "prompt": ""Review every Markdown documentation file and verify that descriptions, examples, or behavior outlines accurately reflect the current code. Only update documentation; do not modify code. Check the corresponding code to confirm behavior before making changes. Correct any inaccuracies or outdated information in descriptions, examples, or behavior outlines. Preserve existing Markdown formatting, style, and structure. Do not add new sections, speculative explanations, or details not present in the code. Only update statements that are clearly incorrect or misleading; do not rewrite text for style or preference. Keep edits minimal and focused, ensuring that the Markdown matches what the code actually does. If verification against the code is ambiguous, leave the documentation unchanged." Use branch name bot/cleanup-<YYMMDD>-<HHMM>",
              "agent": "continuedev/default-background-agent",
              "branchName": "main",
              "repoUrl": "https://github.com/${{ github.repository }}"
            }')
          id=$(echo $response | jq -r '.id')
          echo "https://hub.continue.dev/agents/$id"
